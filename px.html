<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>UV Proxy ラッパー</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <style>
    /* 全体レイアウト */
    html, body {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
      overflow: hidden;
      background: #111;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    /* Three.js 用キャンバス */
    canvas#bg {
      position: absolute;
      top: 0; left: 0;
      width: 100%; height: 100%;
      z-index: -1;
    }
    /* 入力フィールド */
    .input {
      width: 80%;
      max-width: 500px;
      padding: 0.5em 1em;
      font-size: 1rem;
      border-radius: 4px;
      border: 1px solid #444;
      background: rgba(0, 0, 0, 0.6);
      color: #fff;
    }
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r130/three.min.js"></script>
  <script src="/uv.config.js"></script> <!-- 事前に定義済み -->
</head>
<body>
  <canvas id="bg"></canvas>
  <input class="input" type="text" placeholder="URL または 検索語を入力して Enter">
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      initAnimation(); // 背景アニメーションを初期化

      const input = document.querySelector('.input');
      input.addEventListener('keydown', handleInput);

      if (location.hash.length > 1) {
        const raw = decodeURIComponent(location.hash.slice(1));
        input.value = raw;
        redirect(raw);
      }
    });

    function handleInput(e) {
      if (e.key !== 'Enter') return;
      const raw = e.target.value.trim();
      if (!raw) return;
      redirect(raw);
    }

    function redirect(raw) {
      const target = formatSearch(raw);
      const uvUrl = __uv$config.prefix + __uv$config.encodeUrl(target);
      window.location.href = uvUrl;
    }

    function formatSearch(query) {
      try { return new URL(query).toString(); } catch (e) {}
      try {
        const u = new URL('http://' + query);
        if (u.hostname.includes('.')) return u.toString();
      } catch (e) {}
      return 'https://duckduckgo.com/?t=h_&q=' + encodeURIComponent(query);
    }

    function initAnimation() {
      const canvas = document.getElementById('bg');
      const renderer = new THREE.WebGLRenderer({ canvas, antialias: true });
      renderer.setSize(window.innerWidth, window.innerHeight);
      renderer.setPixelRatio(window.devicePixelRatio);

      const scene = new THREE.Scene();
      const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
      camera.position.z = 5;

      // 立体（球体）
      const geometry = new THREE.SphereGeometry(1, 32, 32);
      const material = new THREE.MeshStandardMaterial({ color: 0x00ff88, wireframe: true });
      const sphere = new THREE.Mesh(geometry, material);
      scene.add(sphere);

      // 粒子
      const particleGeometry = new THREE.BufferGeometry();
      const particleCount = 500;
      const positions = new Float32Array(particleCount * 3);

      for (let i = 0; i < particleCount * 3; i++) {
        positions[i] = (Math.random() - 0.5) * 10;
      }

      particleGeometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));
      const particleMaterial = new THREE.PointsMaterial({ color: 0xffffff, size: 0.05 });
      const particles = new THREE.Points(particleGeometry, particleMaterial);
      scene.add(particles);

      // ライト
      const light = new THREE.PointLight(0xffffff, 1, 100);
      light.position.set(2, 2, 5);
      scene.add(light);

      function animate() {
        requestAnimationFrame(animate);
        sphere.rotation.x += 0.01;
        sphere.rotation.y += 0.01;
        particles.rotation.y += 0.002;
        renderer.render(scene, camera);
      }
      
      animate();
      window.addEventListener('resize', () => {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
      });
    }
  </script>
  <script src="./uv/uv.bundle.js"></script>
  <script src="./uv/uv.config.js"></script>
  <script src="./assets/register-sw.js"></script>
  <script src="./assets/script.js" defer></script>

</body>
</html>
